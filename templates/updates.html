{% extends "base.html" %}

{% block title %}What's New - ResetApp{% endblock %}

{% block extra_css %}
<link href="{{ url_for('static', filename='updates.css') }}" rel="stylesheet" />
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="updates-hero">
    <h1 class="display-5 mb-2">What's New in ResetApp</h1>
    <p class="text-muted mb-0">Release notes, fixes, and upcoming improvements.</p>
  </div>

  <div class="updates-filter mt-3">
    <span class="text-muted me-2">Filter version:</span>
    <select class="form-select form-select-sm updates-filter-select" aria-label="Filter updates">
      <option value="all" selected>All</option>
      <option value="1.1.1">1.1.1</option>
      <option value="1.1">1.1</option>
      <option value="1.0.9">1.0.9</option>
      <option value="1.0.8">1.0.8</option>
      <option value="1.0.7">1.0.7</option>
      <option value="1.0.6">1.0.6</option>
      <option value="1.0.5">1.0.5</option>
      <option value="1.0.4">1.0.4</option>
      <option value="1.0.3">1.0.3</option>
      <option value="1.0.2">1.0.2</option>
      <option value="1.0.1">1.0.1</option>
      <option value="1.0.0">1.0.0</option>
    </select>
  </div>

  <div class="updates-grid mt-4">
    <div class="updates-card known-bugs">
      <h4>Known Bugs</h4>
      <ul class="mb-0">
        {% set active_issues = known_issues | selectattr('status', 'equalto', 'Active') | list if known_issues else [] %}
        {% if active_issues %}
          {% for issue in active_issues %}
            <li>{{ issue.text }}</li>
          {% endfor %}
        {% else %}
          <li>No active known issues reported.</li>
        {% endif %}
      </ul>
      <p class="mt-2"><em>We're actively working on fixes.</em></p>
    </div>
    <div class="updates-card bug-report">
      <h4>Report a Bug</h4>
      <p>See something off? Use the in-app bug report form.</p>
      <a class="btn btn-danger btn-lg" href="{{ url_for('report_bug_page') }}">
        ğŸ Open Bug Report
      </a>
    </div>
  </div>

  
  <div class="updates-card mt-4 latest" data-version="1.1.1">
    <h4><span class="date-label">2026-01-28</span> Version 1.1.1</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">Student search now runs a single Admin SDK query with caching for faster results.</li>
      <li class="list-group-item">Search calls now use the routed endpoint, improving reliability behind base paths.</li>
      <li class="list-group-item">System Status layout refreshed for clearer, more even sections.</li>
      <li class="list-group-item">Status summary now includes Google token health at a glance.</li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.1">
    <h4>ğŸ“… <span class="date-label">2026-01-22</span> Version 1.1</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">Updated production domain to reset.hart.k12.ga.us.</li>
      <li class="list-group-item">ğŸ—„ï¸ Migrated audit logs, bug reports, known issues, and login logs to the database.</li>
      <li class="list-group-item">ğŸ§¾ Added data export ZIP for audits, bugs, and known issues.</li>
      <li class="list-group-item">ğŸ§­ Added System Status page with DB, Admin SDK, and Classroom sync checks.</li>
      <li class="list-group-item">ğŸ› ï¸ Known Issues admin tools now support edit, level changes, and delete.</li>
      <li class="list-group-item">ğŸ”’ Dev login routes now 404 when disabled.</li>
    </ul>
  </div>
  <div class="updates-card mt-4" data-version="1.0.9">
    <h4>ğŸ“… <span class="date-label">2026-01-21</span> Version 1.0.9</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">ğŸ§ª In-app bug report form with admin tracking tab.</li>
      <li class="list-group-item">ğŸ“ Bug reports support screenshot uploads.</li>
      <li class="list-group-item">ğŸ–¼ï¸ Bug reports show attachment thumbnails in Admin.</li>
      <li class="list-group-item">ğŸ” Admin audit logs filter by role, school, and OU.</li>
      <li class="list-group-item">ğŸ§¾ Admin actions are logged in audit history.</li>
      <li class="list-group-item">ğŸŒ Login logs capture IP addresses.</li>
      <li class="list-group-item">ğŸ§‘â€ğŸ« Classroom sync shows last sync time and roster count.</li>
      <li class="list-group-item">âš ï¸ Admin/global resets require confirmation.</li>
      <li class="list-group-item">ğŸ“ Bug reports support admin notes and status updates.</li>
      <li class="list-group-item">ğŸ“š Documentation rebuilt with book-stack layout and admin menu details.</li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.8">
    <h4>ğŸ“… <span class="date-label">2025-04-25</span> Version 1.0.8</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸŒ™ <strong>Dark Mode Polish</strong>: hamburger icon now inverts correctly, and nav-menu text & dropdown items all display high-contrast in dark mode.
      </li>
      <li class="list-group-item">
        ğŸ§© <strong>Unified Navbar Partial</strong>: identical styling across all pagesâ€”including help, instructions, and updatesâ€”with working rotate-on-open icons.
      </li>
      <li class="list-group-item">
        ğŸ“„ <strong>Help & Instructions Revamp</strong>: both pages now fully honor light/dark themes, with links and buttons adjusted for readability.
      </li>
      <li class="list-group-item">
        ğŸ¨ <strong>CSS Cleanup</strong>: consolidated overrides, ensured only non-button links get custom colors, and added invert filter on <code>.navbar-toggler-icon</code>.
      </li>
      <li class="list-group-item">
        âš™ï¸ <strong>No More Inline Scripts</strong>: moved all inline JS and styling into external JS/CSS files for cleaner HTML and easier maintenance.
      </li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.7">
    <h4>ğŸ“… <span class="date-label">2025-04-24</span> Version 1.0.7</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸ¨ <strong>Improved UI</strong>: enhanced with smoother layouts and fully responsive design.
      </li>
      <li class="list-group-item">
        ğŸ›¡ï¸ <strong>Hardened Session Management</strong>: tightened cookie flags and session handling.
      </li>
      <li class="list-group-item">
        ğŸ”’ <strong>Added CSP Headers</strong>: Content Security Policy implemented to mitigate XSS risks.
      </li>
      <li class="list-group-item">
        ğŸ“¦ <strong>Dependency Updates</strong>: patched known vulnerabilities by upgrading all dependencies.
      </li>
      <li class="list-group-item">
        ğŸŒ <strong>Forced HTTPS</strong>: redirects now enforced on all protected routes.
      </li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.6">
    <h4>ğŸ“… <span class="date-label">2025-04-23</span> Version 1.0.6</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸ”„ <strong>Enhanced Bug Reporting</strong>: moved report button and known bugs to the top for quick access.
      </li>
      <li class="list-group-item">
        ğŸ› ï¸ <strong>Admin Dashboard Overhaul</strong>: tabs for Audit, Login, Students, Admins, Reset Requests; date filters & search.
      </li>
      <li class="list-group-item">
        ğŸ”’ <strong>Admin Management</strong>: live staff search limited to Staff OU, with confirmation dialogs.
      </li>
      <li class="list-group-item">
        â±ï¸ <strong>Password Reset Limits</strong>: daily cap (default 5), + "Request More" workflow & approval.
      </li>
      <li class="list-group-item">
        ğŸ›¡ï¸ <strong>Staff-Only OAuth Gate</strong>: restrict sign-in by OU prefixes; DEV_LOGIN_BYPASS for local dev.
      </li>
      <li class="list-group-item">
        âš™ï¸ <strong>Error Handling</strong>: custom 403 page, service-account JSON validation, flash feedback on key errors.
      </li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.5">
    <h4>ğŸ“… <span class="date-label">2025-04-22</span> Version 1.0.5</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸ“ <strong>Reset Request Workflow</strong>: teachers can request extra resets; admins can approve/deny from the dashboard.
      </li>
      <li class="list-group-item">
        âœ”ï¸ <strong>Confirmation Dialogs</strong>: added JS confirms for adding/removing admins to prevent mistakes.
      </li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.4">
    <h4>ğŸ“… <span class="date-label">2025-04-22</span> Version 1.0.4</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸ” <strong>Search Enhancements</strong>: added debounced search filters on Audit and Login tabs.
      </li>
      <li class="list-group-item">
        ğŸ› ï¸ <strong>Bug Fix</strong>: fixed issue where date filter wasn't applied to all tabs consistently.
      </li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.3">
    <h4>ğŸ“… <span class="date-label">2025-04-21</span> Version 1.0.3</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸŒ <strong>Pagination</strong>: added paging support for user listings in the Admin dashboard.
      </li>
      <li class="list-group-item">
        ğŸ <strong>Fixed</strong>: users tab now limits results to configured student OUs.
      </li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.2">
    <h4>ğŸ“… <span class="date-label">2025-04-19</span> Version 1.0.2</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸ“‚ <strong>Multi-Page Architecture</strong>: introduced Admin Dashboard with dedicated tabs for logs, users, and requests.
      </li>
      <li class="list-group-item">
        ğŸ› <strong>Fixed service account load error</strong>: explicit JSON key check and UTF-8 validation.
      </li>
      <li class="list-group-item">
        ğŸ¨ <strong>Styling & Performance</strong>: refreshed UI components and optimized log data caching.
      </li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.1">
    <h4>ğŸ“… <span class="date-label">2025-04-17</span> Version 1.0.1</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸ” <strong>Login Page</strong>: added Google OAuth based login screen to secure access.
      </li>
    </ul>
  </div>

  <div class="updates-card mt-4" data-version="1.0.0">
    <h4>ğŸ“… <span class="date-label">2025-04-10</span> Version 1.0.0</h4>
    <ul class="list-group updates-list">
      <li class="list-group-item">
        ğŸš€ <strong>Initial Release</strong>: single-page password reset interface for students.
      </li>
    </ul>
  </div>

  <div class="mt-4">
    <button class="btn btn-outline-secondary" onclick="history.back()">Back</button>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  const versionCards = document.querySelectorAll('[data-version]');
  const versionSelect = document.querySelector('.updates-filter-select');

  function applyFilter(value) {
    versionCards.forEach(card => {
      card.style.display = (value === 'all' || card.dataset.version === value) ? '' : 'none';
    });
    if (versionSelect) versionSelect.value = value;
  }

  if (versionSelect) {
    versionSelect.addEventListener('change', () => applyFilter(versionSelect.value));
  }
</script>
{% endblock %}
