{% extends "admin_layout.html" %}

{% set page_title = "Login Logs" %}

{% block admin_header %}
<div class="admin-hero d-flex flex-wrap align-items-end justify-content-between gap-3">
  <div>
    <h1 class="display-6 mb-1">Login Logs</h1>
    <p class="text-muted mb-0">Review successful and failed sign-ins.</p>
  </div>
  <form class="d-flex flex-wrap gap-2" method="get">
    <input type="date" name="start_date" class="form-control" value="{{ request.args.get('start_date','') }}">
    <input type="date" name="end_date" class="form-control" value="{{ request.args.get('end_date','') }}">
    <button class="btn btn-primary">Filter</button>
  </form>
</div>
{% endblock %}

{% block admin_body %}
<div class="admin-panel mt-3">
  <input id="search-login" class="form-control mb-3" placeholder="Search login events" />

  <div class="table-responsive admin-table">
    <table class="table table-striped" id="tbl-login">
      <thead>
        <tr><th>Timestamp</th><th>User</th><th>Outcome/IP</th></tr>
      </thead>
      <tbody>
        {% for l in login_logs %}
          <tr>
            <td>{{ l.timestamp }}</td>
            <td>{{ l.user }}</td>
            <td>{{ l.outcome }}{% if l.ip %} ({{ l.ip }}){% endif %}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block admin_js %}
<script>
  const loginSearch = document.getElementById('search-login');
  const loginTable = document.getElementById('tbl-login');
  if (loginSearch && loginTable) {
    loginSearch.addEventListener('input', () => {
      const q = loginSearch.value.toLowerCase();
      Array.from(loginTable.tBodies[0].rows).forEach(row => {
        row.style.display = row.textContent.toLowerCase().includes(q) ? '' : 'none';
      });
    });
  }
</script>
{% endblock %}
